<div class="register-container">
  <div class="register-header">
    <app-theme-toggle />
  </div>

  <mat-card class="register-card" appearance="outlined">
    <mat-card-header>
      <mat-card-title>
        <div class="logo">
          <mat-icon class="logo-icon">checklist</mat-icon>
          <span>Todolist</span>
        </div>
        <p class="subtitle">Create your account</p>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      @if (error(); as err) {
        <div class="error-banner" role="alert">
          <mat-icon>error_outline</mat-icon>
          <span>{{ err.message }}</span>
        </div>
      }

      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <mat-form-field appearance="outline">
          <mat-label>Name</mat-label>
          <mat-icon matPrefix>person_outline</mat-icon>
          <input
            matInput
            type="text"
            formControlName="name"
            autocomplete="name"
            placeholder="Type your name"
            [attr.aria-describedby]="form.controls.name.invalid && form.controls.name.touched ? 'name-error' : null"
          />
          @if (form.controls.name.hasError('required') && form.controls.name.touched) {
            <mat-error id="name-error">Name is required</mat-error>
          } @else if (form.controls.name.hasError('minlength') && form.controls.name.touched) {
            <mat-error id="name-error">Name must be at least 2 characters</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <mat-icon matPrefix>mail_outline</mat-icon>
          <input
            matInput
            type="email"
            formControlName="email"
            autocomplete="email"
            placeholder="Type your email"
            [attr.aria-describedby]="form.controls.email.invalid && form.controls.email.touched ? 'email-error' : null"
          />
          @if (form.controls.email.hasError('required') && form.controls.email.touched) {
            <mat-error id="email-error">Email is required</mat-error>
          } @else if (form.controls.email.hasError('email') && form.controls.email.touched) {
            <mat-error id="email-error">Enter a valid email</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Password</mat-label>
          <mat-icon matPrefix>lock_outline</mat-icon>
          <input
            matInput
            [type]="hidePassword() ? 'password' : 'text'"
            formControlName="password"
            autocomplete="new-password"
            placeholder="Type your password"
            [attr.aria-describedby]="form.controls.password.invalid && form.controls.password.touched ? 'password-error' : null"
          />
          <button
            mat-icon-button
            matSuffix
            type="button"
            [attr.aria-label]="hidePassword() ? 'Show password' : 'Hide password'"
            (click)="togglePasswordVisibility()"
          >
            <mat-icon>{{ hidePassword() ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          @if (form.controls.password.hasError('required') && form.controls.password.touched) {
            <mat-error id="password-error">Password is required</mat-error>
          } @else if (form.controls.password.hasError('minlength') && form.controls.password.touched) {
            <mat-error id="password-error">Password must be at least 6 characters</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Confirm Password</mat-label>
          <mat-icon matPrefix>lock_outline</mat-icon>
          <input
            matInput
            [type]="hidePasswordConfirmation() ? 'password' : 'text'"
            formControlName="passwordConfirmation"
            autocomplete="new-password"
            placeholder="Confirm your password"
            [attr.aria-describedby]="form.controls.passwordConfirmation.invalid && form.controls.passwordConfirmation.touched ? 'password-confirmation-error' : null"
          />
          <button
            mat-icon-button
            matSuffix
            type="button"
            [attr.aria-label]="hidePasswordConfirmation() ? 'Show password confirmation' : 'Hide password confirmation'"
            (click)="togglePasswordConfirmationVisibility()"
          >
            <mat-icon>{{ hidePasswordConfirmation() ? 'visibility' : 'visibility_off' }}</mat-icon>
          </button>
          @if (form.controls.passwordConfirmation.hasError('required') && form.controls.passwordConfirmation.touched) {
            <mat-error id="password-confirmation-error">Password confirmation is required</mat-error>
          } @else if (form.controls.passwordConfirmation.hasError('passwordMismatch') && form.controls.passwordConfirmation.touched) {
            <mat-error id="password-confirmation-error">Passwords do not match</mat-error>
          }
        </mat-form-field>

        <button
          mat-flat-button
          type="submit"
          class="register-button"
          [disabled]="loading()"
        >
          @if (loading()) {
            <mat-spinner diameter="20" />
          } @else {
            <span class="button-content">
              <mat-icon>person_add</mat-icon>
              <span>Create account</span>
            </span>
          }
        </button>
      </form>

      <div class="login-link">
        <span>Already have an account?</span>
        <a routerLink="/auth/login">Sign in</a>
      </div>
    </mat-card-content>
  </mat-card>

  <p class="footer-text">
    Todolist App &copy; 2026
  </p>
</div>

